#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” commit ì´ì „ì— prettier, lint ê·œì¹™ì„ ì ìš©í•©ë‹ˆë‹¤..."

# lint-staged ì‹¤í–‰
npx lint-staged
if [ $? -ne 0 ]; then
  echo "âŒ lint-staged ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
  exit 1
fi

# ì‚­ì œëœ íŒŒì¼ì€ ì œì™¸í•˜ê³  ì¡´ì¬í•˜ëŠ” íŒŒì¼ë§Œ ìŠ¤í…Œì´ì§•
changed_files=$(git diff --name-only --staged --diff-filter=d)
if [ $? -ne 0 ]; then
  echo "âŒ ë³€ê²½ëœ íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
  exit 1
fi

# ì¡´ì¬í•˜ëŠ” íŒŒì¼ë§Œ ë‹¤ì‹œ ìŠ¤í…Œì´ì§•
for file in $changed_files; do
  if [ -f "$file" ]; then
    git add "$file"
  fi
done

echo "âœ… ëª¨ë“  prettier, lint ê·œì¹™ì´ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤."